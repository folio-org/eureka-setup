FROM alpine:3.20

RUN apk update && apk add --no-cache \
        wget=1.24.5-r0 \
        openjdk17-jre-headless=17.0.16_p8-r0 \
        coreutils=9.5-r2 \
        bash=5.2.26-r0 \
        procps-ng=4.0.4-r0 && \
    wget -q https://dlcdn.apache.org/kafka/4.1.0/kafka_2.13-4.1.0.tgz && \
    tar -xzf kafka_2.13-4.1.0.tgz && \
    mv kafka_2.13-4.1.0 /opt/kafka && \
    ln -s /opt/kafka/bin/* /usr/local/bin/ && \
    rm kafka_2.13-4.1.0.tgz && \
    rm -rf /var/cache/apk/* && \
    which bash && ls -la /bin/bash && \
    addgroup -g 1000 kafka && \
    adduser -D -u 1000 -G kafka kafka && \
    chown -R kafka:kafka /opt/kafka
    
ENV PATH="/opt/kafka/bin:/usr/bin:/bin:$PATH"

USER kafka

CMD ["/bin/sleep", "infinity"]